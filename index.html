<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stephen Muhammed | Author of Afrofuturistic Tales</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #f3f4f6;
      --bg-secondary: #ffffff;
      --text-primary: #111827;
      --accent-primary: #4a5568;
      --accent-hover: #2d3748;
      --highlight: #fefcbf;
      --highlight-border: #f6e05e;
    }
    .theme-dark {
      --bg-primary: #1f2937;
      --bg-secondary: #111827;
      --text-primary: #f3f4f6;
      --accent-primary: #4b5563;
      --accent-hover: #6b7280;
      --highlight: #78350f;
      --highlight-border: #9a3412;
    }
    .theme-cosmic {
      --bg-primary: #1e1b4b;
      --bg-secondary: #2e236c;
      --text-primary: #e0e7ff;
      --accent-primary: #7c3aed;
      --accent-hover: #a78bfa;
      --highlight: #c4b5fd;
      --highlight-border: #a78bfa;
    }
    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      transition: all 0.3s ease;
    }
    .typing-effect {
      white-space: nowrap;
      overflow: hidden;
      border-right: 2px solid var(--text-primary);
      animation: blink 0.75s step-end infinite;
    }
    @keyframes blink {
      50% { border-color: transparent; }
    }
    .read-btn {
      background-color: var(--accent-primary);
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 0.25rem;
      transition: background-color 0.3s ease;
    }
    .read-btn:hover {
      background-color: var(--accent-hover);
    }
    .bg-white { background-color: var(--bg-secondary); }
    .bg-gray-100 { background-color: var(--bg-primary); }
    .bg-gray-900 { background-color: var(--accent-primary); }
    .text-gray-900 { color: var(--text-primary); }
    .text-gray-800 { color: var(--text-primary); }
    .text-gray-700 { color: var(--text-primary); }
    .bg-yellow-400 { background-color: var(--highlight); }
    .border-gray-700 { border-color: var(--accent-primary); }
    /* Stevebot Styles */
    .chatbot-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
    }
    .chatbot-toggle {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
      color: #fff;
      padding: 2px;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .chatbot-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0);
    }
    .chatbot-window {
      display: none;
      width: 380px;
      height: 520px;
      background: var(--bg-secondary);
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0.3);
      overflow: hidden;
      flex-direction: column;
      animation: slideIn 0.4s ease;
      resize: vertical;
      min-height: 400px;
      max-height: 650px;
      position: relative;
    }
    .chatbot-window::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1), 0%, transparent 70%);
      pointer-events: none;
      opacity: 0.5;
    }
    @keyframes slideIn {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .chatbot-header {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-hover));
      color: #fff;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: 1.1rem;
    }
    .chatbot-header img {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      margin-right: 12px;
      border: 2px solid var(--highlight-border);
    }
    .chatbot-header .settings {
      margin-left: auto;
      cursor: pointer;
    }
    .chatbot-body {
      flex-grow: 1;
      padding: 16px;
      overflow-y: auto;
      background: var(--bg-secondary);
      position: relative;
    }
    .chatbot-message {
      margin-bottom: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      line-height: 1.5;
      max-width: 85%;
      position: relative;
      animation: fadeIn 0.3s ease;
    }
    .chatbot-message.user {
      background: var(--highlight);
      margin-left: auto;
      border: 1px solid var(--highlight-border);
    }
    .chatbot-message.bot {
      background: var(--bg-primary);
      margin-right: auto;
      border-left:1px solid var(--accent-primary);
    }
    .chatbot-message .timestamp {
      font-size: 0.7rem;
      color: var(--accent-primary);
      margin-top: 4px;
      text-align: right;
    }
    .chatbot-message.searching::after {
      content: 'Searching the cosmos...';
      display: block;
      font-size: 0.8rem;
      color: var(--accent-primary);
      animation: pulse 1s infinite;
    }
    .chatbot-message.typing::after {
      content: 'Analyzing...';
      display: block;
      font-size: 0.8rem;
      color: var(--accent-primary);
      animation: pulse 1s infinite;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      50% { opacity: 0.5; }
    }
    .chatbot-input {
      display: flex;
      padding: 12px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--accent-primary);
    }
    .chatbot-input input {
      flex-grow: 1;
      padding: 10px;
      border: 1px solid var(--accent-primary);
      border-radius: 8px;
      margin-right: 8px;
      transition: border-color 0.2s ease;
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .chatbot-input input:focus {
      border-color: var(--highlight);
      outline: none;
    }
    .chatbot-input button {
      background: var(--accent-primary);
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      transition: background 0.2s ease;
    }
    .chatbot-input button:hover {
      background: var(--accent-hover);
    }
    .theme-switcher select {
      background: var(--accent-primary);
      color: #fff;
      padding: 8px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .theme-switcher select:focus {
      outline: none;
      border-color: var(--highlight);
    }
    .progress-bar {
      width: 100%;
      height: 4px;
      background: var(--accent-primary);
      margin-bottom: 8px;
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-bar div {
      height: 100%;
      background: var(--highlight);
      transition: width 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

  <!-- Header -->
  <header class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-6 flex justify-between items-center">
      <h1 class="text-2xl font-bold">Stephen Muhammed</h1>
      <div class="flex items-center space-x-4">
        <nav>
          <ul class="flex space-x-6">
            <li><a href="#books" class="hover:text-yellow-400">Books</a></li>
            <li><a href="#about" class="hover:text-yellow-400">About</a></li>
            <li><a href="#contact" class="hover:text-yellow-400">Contact</a></li>
            <li><a href="#quiz" class="hover:text-yellow-400">Trivia Quiz</a></li>
          </ul>
        </nav>
        <div class="theme-switcher">
          <select id="themeSelect" onchange="changeTheme()">
            <option value="default">Default</option>
            <option value="dark">Dark</option>
            <option value="cosmic">Cosmic</option>
          </select>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="bg-yellow-400 text-gray-900 py-20">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-4xl font-bold mb-4">Welcome to the world of</h2>
      <p class="text-2xl typing-effect" id="typing-text"></p>
    </div>
  </section>

  <!-- Books Section -->
  <section id="books" class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold mb-8 text-center">Books</h2>
      <div class="grid md:grid-cols-3 gap-8">
        <!-- Book 1 -->
        <div class="book-item bg-gray-50 p-6 rounded shadow-lg">
          <img src="Pishon.jpg" alt="Pishon" class="w-64 h-70 object-cover mb-4 rounded mx-auto">
          <h3 class="text-xl font-bold text-center">Pishon: the uprising</h3>
          <p class="mt-2 text-gray-700 text-center">Dayo, an ordinary man with extraordinary abilities, rises to become the Super Agent, tasked with safeguarding Pishon from threats both internal and external. However, as he embraces his new role, he uncovers a web of political conspiracies, supernatural forces, and power struggles that threaten to tear the kingdom apart. The peace Pishon once knew is fragile, and Dayo must confront enemies not only from outside but from within its very walls.

With the kingdom on the brink of chaos, Dayo must navigate the shadows of Pishon's power structure, protecting its people while unraveling the mysteries of his own identity. The fate of Pishon rests in his hands. This is the tale of a protector, a kingdom, and the battle against forces beyond comprehension.</p>
          <div class="mt-4 text-center">
            <a href="Pishon.html" class="read-btn inline-block mr-2">Read Online</a>
            <a href="#" class="text-gray-900 hover:underline">Buy Now</a>
          </div>
        </div>
        <!-- Book 2 -->
        <div class="book-item bg-gray-50 p-6 rounded shadow-lg">
          <img src="Flare.jpg" alt="The Flare" class="w-64 h-70 object-cover mb-4 rounded mx-auto">
          <h3 class="text-xl font-bold text-center">The Flare</h3>
          <p class="mt-2 text-gray-700 text-center">In the neon-lit streets of Wellrose, a city teetering on the edge of chaos, a fiery crash in 2100 unleashes the Neon Stone--an alien artifact that ignites a war between heroes and monsters. Alex Rosicky, a grieving son resurrected by its power, rises as The Flare, a lightning-fueled vigilante fighting to save a city that fears him. Alongside his team, the Paragon, he battles rogue superhumans, a ruthless corporation, and a sister lost to darkness. As Genesys Corp tightens its grip and an ancient evil awakens, Alex must confront his past and unite a fractured world to stop a catastrophe that threatens all of humanity. Packed with heart-pounding action and raw emotion, The Flare is a gripping tale of sacrifice, redemption, and the unyielding spark of heroism.</p>
          <div class="mt-4 text-center">
            <a href="Flare.html" class="read-btn inline-block mr-2">Read Online</a>
            <a href="#" class="text-gray-900 hover:underline">Buy Now</a>
          </div>
        </div>
        <!-- Book 3 -->
        <div class="book-item bg-gray-50 p-6 rounded shadow-lg">
          <img src="Orchids.jpg" alt="Orchids" class="w-64 h-70 object-cover mb-4 rounded mx-auto">
          <h3 class="text-xl font-bold text-center">Orchids</h3>
          <p class="mt-2 text-gray-700 text-center">The tale of a love that spans ages.</p>
          <div class="mt-4 text-center">
            <a href="Orchids.html" class="read-btn inline-block mr-2">Read Online</a>
            <a href="#" class="text-gray-900 hover:underline">Buy Now</a>
          </div>
        </div>
        <!-- Book 4 -->
        <div class="book-item bg-gray-50 p-6 rounded shadow-lg">
          <img src="teen.jpg" alt="teenage" class="w-64 h-70 object-cover mb-4 rounded mx-auto">
          <h3 class="text-xl font-bold text-center">Teen-Age R</h3>
          <p class="mt-2 text-gray-700 text-center">In a world where superheroes and extraordinary events are the norm, 'Ordinary Lives' follows the journey of average high school teenagers navigating love, friendship, and adolescence amidst the chaos. This relatable coming-of-age story explores themes of identity, self-discovery and the struggles of growing up, all while surrounded by the extraordinary. Dive into the lives of these teenagers as they try to find their place in a world that's anything but ordinary.</p>
          <div class="mt-4 text-center">
            <a href="Teenage.html" class="read-btn inline-block mr-2">Read Online</a>
            <a href="#" class="text-gray-900 hover:underline">Buy Now</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="py-16 bg-gray-100">
    <div class="container mx-auto px-4 max-w-3xl text-center">
      <h2 class="text-3xl font-bold mb-6">About Stephen</h2>
      <p class="text-lg text-gray-800">
        Stephen Muhammed (Justice Muhammed Okan) is a Nigerian writer and teacher from Auchi, Edo State. Since age 16, he's been crafting Afrofuturistic stories that blend culture, adventure, and imagination. He holds a degree in Educational Administration from the University of Abuja and teaches in a secondary school while pursuing his passion for storytelling.
      </p>
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="py-16 bg-white">
    <div class="container mx-auto px-4 max-w-xl">
      <h2 class="text-3xl font-bold mb-6 text-center">Contact</h2>
      <form class="space-y-6">
        <input type="text" placeholder="Your Name" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-700" required>
        <input type="email" placeholder="Your Email" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-700" required>
        <textarea id="message" class="w-full p-3 rounded bg-gray-800 text-white border border-gray-700" rows="5" placeholder="Your Message" required></textarea>
        <button type="submit" class="bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold py-2 px-6 rounded">Send</button>
      </form>
    </div>
  </section>

  <!-- Trivia Quiz Placeholder -->
  <section id="quiz" class="py-16 bg-gray-100">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-4">Trivia Quiz (Coming Soon)</h2>
      <p class="text-gray-700">Test your knowledge of literature, African culture, and more!</p>
    </div>
  </section>

  <!-- Stevebot -->
  <div class="chatbot-container">
    <div class="chatbot-toggle" onclick="toggleChatbot()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
      </svg>
    </div>
    <div class="chatbot-window" id="chatbotWindow">
      <div class="chatbot-header">
        <img src="https://via.placeholder.com/36?text=SB" alt="Stevebot Avatar" />
        Stevebot: Your Cosmic Science Guide
        <span class="settings" onclick="toggleVoice()">üîä</span>
      </div>
      <div class="chatbot-body" id="chatbotBody">
        <div class="chatbot-message bot">Yo, what‚Äôs good, fam? I‚Äôm Stevebot, your science-loving homie, ready to vibe with Stephen Muhammed‚Äôs Afrofuturistic bangers! üåå Got the 411 on *Pishon*, *The Flare*, and more. Ask me anything, flex your brain with ‚ÄúTrivia Challenge,‚Äù or let‚Äôs cook up a story in ‚ÄúStory Weaver.‚Äù What‚Äôs the move? üöÄ</div>
      </div>
      <div class="chatbot-input">
        <input type="text" id="chatbotInput" placeholder="Ask, play, or teach Stevebot..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-6 text-center">
    <p>¬© 2025 Stephen Muhammed. All rights reserved.</p>
  </footer>

  <!-- Scripts -->
  <script>
    // Theme Switcher
    function changeTheme() {
      const theme = document.getElementById('themeSelect').value;
      document.body.className = `bg-gray-100 text-gray-900 font-sans ${theme === 'default' ? '' : `theme-${theme}`}`;
      localStorage.setItem('theme', theme);
    }
    window.onload = () => {
      const savedTheme = localStorage.getItem('theme') || 'default';
      document.getElementById('themeSelect').value = savedTheme;
      changeTheme();
      type();
    };

    // Typing Effect Script
    const text = ["Afrofuturistic Worlds", "African Heroes", "Speculative Tales"];
    let count = 0;
    let index = 0;
    let currentText = '';
    let letter = '';

    function type() {
      if (count === text.length) count = 0;
      currentText = text[count];
      letter = currentText.slice(0, ++index);
      document.getElementById('typing-text').textContent = letter;
      if (letter.length === currentText.length) {
        count++;
        index = 0;
        setTimeout(type, 1500);
      } else {
        setTimeout(type, 150);
      }
    }

    // Stevebot Script
    const books = Array.from(document.querySelectorAll('.book-item')).map(item => ({
      title: item.querySelector('h3').textContent.trim().toLowerCase(),
      description: item.querySelector('p').textContent.trim(),
      image: item.querySelector('img').src,
      readLink: item.querySelector('.read-btn')?.href || '#',
      buyLink: item.querySelector('.text-gray-900')?.href || '#',
      genres: inferGenres(item.querySelector('p').textContent.trim())
    }));

    function inferGenres(description) {
      const genres = [];
      if (description.match(/superhero|vigilante|hero/i)) genres.push('superhero');
      if (description.match(/love|romance/i)) genres.push('romance');
      if (description.match(/sci-fi|futuristic|alien|technology/i)) genres.push('sci-fi');
      if (description.match(/teen|adolescence|youth/i)) genres.push('young adult');
      return genres.length ? genres : ['general'];
    }

    let learnedTopics = JSON.parse(localStorage.getItem('learnedTopics')) || {};
    let gameState = JSON.parse(localStorage.getItem('gameState')) || { triviaScore: 0, storyWeaver: [] };
    let learningMode = { active: false, step: 0, data: {} };
    let conversationContext = [];
    let voiceEnabled = true;

    const slangDictionary = {
      'lit': { sentiment: 'positive', meaning: 'amazing, exciting' },
      'fire': { sentiment: 'positive', meaning: 'awesome, high-quality' },
      'slaps': { sentiment: 'positive', meaning: 'really good, impressive' },
      'vibes': { sentiment: 'neutral', meaning: 'mood, atmosphere' },
      'fam': { sentiment: 'positive', meaning: 'close friends, community' },
      'slay': { sentiment: 'positive', meaning: 'do something exceptionally well' },
      'goat': { sentiment: 'positive', meaning: 'greatest of all time' },
      'bet': { sentiment: 'neutral', meaning: 'okay, agreed' },
      'cap': { sentiment: 'negative', meaning: 'lie, not true' },
      'no cap': { sentiment: 'positive', meaning: 'honest, truthful' },
      'drip': { sentiment: 'positive', meaning: 'style, swagger' },
      'tea': { sentiment: 'neutral', meaning: 'gossip, news' },
      'sus': { sentiment: 'negative', meaning: 'suspicious, questionable' }
    };

    function toggleChatbot() {
      const chatbotWindow = document.getElementById('chatbotWindow');
      chatbotWindow.style.display = chatbotWindow.style.display === 'flex' ? 'none' : 'flex';
      if (voiceEnabled && chatbotWindow.style.display === 'flex') {
        speak('Stevebot online! What‚Äôs the vibe, fam?');
      }
    }

    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      document.querySelector('.settings').textContent = voiceEnabled ? 'üîä' : 'üîá';
    }

    function speak(text) {
      if (voiceEnabled) {
        const utterance = new SpeechSynthesisUtterance(text.replace(/<[^>]+>/g, ''));
        utterance.rate = 1.1;
        utterance.pitch = 1.0;
        window.speechSynthesis.speak(utterance);
      }
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function showTypingIndicator() {
      const chatbotBody = document.getElementById('chatbotBody');
      const typingMessage = document.createElement('div');
      typingMessage.className = 'chatbot-message bot typing';
      chatbotBody.appendChild(typingMessage);
      chatbotBody.scrollTop = chatbotBody.scrollHeight;
      return typingMessage;
    }

    function showSearchIndicator() {
      const chatbotBody = document.getElementById('chatbotBody');
      const searchMessage = document.createElement('div');
      searchMessage.className = 'chatbot-message bot searching';
      chatbotBody.appendChild(searchMessage);
      chatbotBody.scrollTop = chatbotBody.scrollHeight;
      return searchMessage;
    }

    function removeIndicator(indicator) {
      if (indicator) indicator.remove();
    }

    function getTimestamp() {
      return new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }

    function tokenizeInput(input) {
      return input.toLowerCase().split(/[\s,.!?]+/).filter(t => t);
    }

    function fuzzyMatch(str, pattern) {
      const regex = new RegExp(pattern.split('').join('.*'), 'i');
      return regex.test(str);
    }

    async function searchWeb(query) {
      // Simulated web search (replace with real API in production)
      return new Promise(resolve => {
        setTimeout(() => {
          if (query.match(/afrofuturism|sci-fi|literature/i)) {
            resolve(`Found on the web: Afrofuturism in 2025 is thriving, with new authors blending African mythology and cutting-edge tech. Recent trends highlight works like *${books[0].title}* for their quantum-inspired themes.`);
          } else if (query.match(/recent|new|2025/i)) {
            resolve(`Web update: As of June 2025, Stephen Muhammed‚Äôs latest works continue to push Afrofuturist boundaries, with *The Flare* gaining buzz for its biotech themes.`);
          } else {
            resolve(`Web search: No specific info found, but I can vibe with general knowledge or check Stephen‚Äôs books!`);
          }
        }, 1000);
      });
    }

    function parseIntent(tokens) {
      const intents = {
        greeting: ['hi', 'hello', 'hey', 'greetings', 'yo', 'sup', 'what‚Äôs good', 'what‚Äôs up', 'wassup', 'hola', 'howdy'],
        help: ['help', 'what can you do', 'commands'],
        about: ['who is stephen', 'about stephen', 'stephen muhammed'],
        bookQuery: ['about', 'what is', 'tell me', 'describe', 'story of', 'themes', 'science'],
        listBooks: ['books', 'novels', 'stories', 'list books'],
        recommend: ['recommend', 'suggest', 'what should i read'],
        teach: ['teach', 'learn', 'add book'],
        update: ['update', 'edit'],
        forget: ['forget', 'delete', 'remove'],
        quote: ['quote', 'say something', 'inspire me'],
        trivia: ['trivia', 'quiz', 'challenge'],
        storyWeaver: ['story weaver', 'tell a story', 'build a story'],
        slang: Object.keys(slangDictionary),
        emoji: /^[\u{1F600}-\u{1F64F}]+$/u
      };
      let matchedIntent = 'unknown';
      const inputText = tokens.join(' ');
      if (intents.greeting.some(t => tokens.includes(t))) matchedIntent = 'greeting';
      else if (intents.help.some(t => tokens.includes(t))) matchedIntent = 'help';
      else if (intents.about.some(t => inputText.includes(t))) matchedIntent = 'about';
      else if (intents.bookQuery.some(t => inputText.includes(t))) matchedIntent = 'bookQuery';
      else if (intents.listBooks.some(t => inputText.includes(t))) matchedIntent = 'listBooks';
      else if (intents.recommend.some(t => inputText.includes(t))) matchedIntent = 'recommend';
      else if (intents.teach.some(t => inputText.includes(t))) matchedIntent = 'teach';
      else if (intents.update.some(t => inputText.includes(t))) matchedIntent = 'update';
      else if (intents.forget.some(t => inputText.includes(t))) matchedIntent = 'forget';
      else if (intents.quote.some(t => inputText.includes(t))) matchedIntent = 'quote';
      else if (intents.trivia.some(t => inputText.includes(t))) matchedIntent = 'trivia';
      else if (intents.storyWeaver.some(t => inputText.includes(t))) matchedIntent = 'storyWeaver';
      else if (intents.slang.some(t => tokens.includes(t))) matchedIntent = 'slang';
      else if (intents.emoji.test(inputText)) matchedIntent = 'emoji';
      return { intent: matchedIntent, tokens };
    }

    async function sendMessage() {
      const input = document.getElementById('chatbotInput');
      const chatbotBody = document.getElementById('chatbotBody');
      const message = input.value.trim();
      if (!message) return;

      const userMessage = document.createElement('div');
      userMessage.className = 'chatbot-message user';
      userMessage.innerHTML = `${message}<div class="timestamp">${getTimestamp()}</div>`;
      chatbotBody.appendChild(userMessage);

      const typingDelay = Math.min(2000, message.length * 50 + 500);
      let indicator = showTypingIndicator();
      let response = await getBotResponse(message);
      
      // Check if web search is needed
      const tokens = tokenizeInput(message);
      const { intent } = parseIntent(tokens);
      if (intent === 'unknown' || message.match(/recent|new|2025|afrofuturism/i)) {
        removeIndicator(indicator);
        indicator = showSearchIndicator();
        const webResult = await searchWeb(message);
        response = `${response ? `${response}<br><br>` : ''}üåê ${webResult}`;
      }

      setTimeout(() => {
        removeIndicator(indicator);
        const botMessage = document.createElement('div');
        botMessage.className = 'chatbot-message bot';
        botMessage.innerHTML = `${response}<div class="timestamp">${getTimestamp()}</div>`;
        chatbotBody.appendChild(botMessage);
        chatbotBody.scrollTop = chatbotBody.scrollHeight;
        speak(response);
      }, typingDelay);

      conversationContext.push({ user: message, timestamp: getTimestamp(), slang: tokens.filter(t => slangDictionary[t]) });
      if (conversationContext.length > 10) conversationContext.shift();
      input.value = '';
    }

    async function getBotResponse(message) {
      const tokens = tokenizeInput(message);
      const { intent, tokens: parsedTokens } = parseIntent(tokens);

      // Greeting
      if (intent === 'greeting') {
        const userSlang = conversationContext.flatMap(c => c.slang || []).slice(-2);
        const greeting = userSlang.length ? `Yo, what‚Äôs good, ${userSlang.includes('fam') ? 'fam' : 'homie'}?` : `Sup, cosmic explorer?`;
        return `${greeting} I‚Äôm Stevebot, your science-loving guide to Stephen Muhammed‚Äôs Afrofuturistic bangers. üå† *${books[0].title}*‚Äôs quantum tech is straight fire! Wanna dive in, flex with a ‚ÄúTrivia Challenge,‚Äù or cook up a ‚ÄúStory Weaver‚Äù tale? What‚Äôs the vibe? üòé`;
      }

      // Help
      if (intent === 'help') {
        return `I‚Äôm Stevebot, your science-savvy homie! üöÄ Here‚Äôs the 411:<br>
        - Book info: ‚ÄúWhat‚Äôs *Pishon*‚Äôs science?‚Äù or ‚ÄúThemes in *The Flare*‚Äù<br>
        - List books: ‚ÄúWhat‚Äôs Stephen got?‚Äù<br>
        - Recommendations: ‚ÄúHit me with a sci-fi rec‚Äù<br>
        - Teach me: ‚ÄúTeach: StarVoyage: Sci-fi epic‚Äù<br>
        - Update/Forget: ‚ÄúUpdate: StarVoyage‚Äù or ‚ÄúForget: StarVoyage‚Äù<br>
        - Fun: ‚ÄúDrop a quote‚Äù or ‚ÄúTrivia Challenge‚Äù or ‚ÄúStory Weaver‚Äù<br>
        - About: ‚ÄúWho‚Äôs Stephen Muhammed?‚Äù<br>
        Say something lit, and let‚Äôs vibe through the multiverse! üåå`;
      }

      // Slang
      if (intent === 'slang') {
        const slangTerm = tokens.find(t => slangDictionary[t]);
        const { sentiment, meaning } = slangDictionary[slangTerm];
        const bookMatch = books.find(b => parsedTokens.some(t => fuzzyMatch(b.title, t)));
        if (bookMatch) {
          if (sentiment === 'positive') {
            return `Yo, you think *${bookMatch.title}* is ${slangTerm}? Bet, it‚Äôs ${meaning}! üî• ${bookMatch.description.substring(0, 100)}... <a href="${bookMatch.readLink}" class="text-yellow-400 hover:underline">Check it</a>. Wanna geek out on its science or play ‚ÄúTrivia Challenge‚Äù?`;
          } else if (sentiment === 'negative') {
            return `Aight, *${bookMatch.title}* ain‚Äôt ${slangTerm}, fam! üòÖ It‚Äôs got ${bookMatch.genres.join(', ')} vibes. Give it a shot? <a href="${bookMatch.readLink}" class="text-yellow-400 hover:underline">Read it</a>. Or let‚Äôs switch to ‚ÄúStory Weaver‚Äù for some fun!`;
          }
        }
        return `That‚Äôs ${slangTerm}, huh? ${meaning.charAt(0).toUpperCase() + meaning.slice(1)} vibes! üòé Wanna talk books, drop some ‚Äútea‚Äù on a new topic, or flex with ‚ÄúTrivia Challenge‚Äù?`;
      }

      // About Stephen
      if (intent === 'about') {
        return `Stephen Muhammed, aka Justice Muhammed Okan, is the GOAT of Afrofuturism from Auchi, Nigeria. Since his teens, he‚Äôs been dropping bangers that mix culture, adventure, and next-level science‚Äîlike quantum vibes in *Pishon* or biotech in *The Flare*. He‚Äôs got a degree in Educational Administration and teaches while slaying the storytelling game. Wanna dive into his books or break down their science? üß¨`;
      }

      // List Books
      if (intent === 'listBooks') {
        const bookList = books.map(book => `<strong>${book.title}</strong>: ${book.description.substring(0, 50)}... <a href="${book.readLink}" class="text-yellow-400 hover:underline">Read more</a>`).join('<br><br>');
        const learnedList = Object.keys(learnedTopics).length ? `<br>Plus, I‚Äôve got the tea on: ${Object.keys(learnedTopics).map(t => `<strong>${t}</strong>`).join(', ')}.` : '';
        return `Stephen‚Äôs catalog is straight fire! üìö Check it:<br>${bookList}${learnedList}<br>Wanna deep dive or slay a ‚ÄúTrivia Challenge‚Äù? üòÑ`;
      }

      // Book Query
      if (intent === 'bookQuery') {
        const book = books.find(b => parsedTokens.some(t => fuzzyMatch(b.title, t)));
        if (book) {
          let response = `Let‚Äôs vibe with <strong>${book.title}</strong>! üåå ${book.description}`;
          if (tokens.includes('science') || tokens.includes('scientific')) {
            if (book.title.includes('flare')) {
              response += `<br><br>Science check: *The Flare*‚Äôs Neon Stone is like a zero-point energy crystal, pulling power from quantum fluctuations. Straight sci-fi drip! Wanna nerd out more? üß¨`;
            } else if (book.title.includes('pishon')) {
              response += `<br><br>Science vibes: *Pishon*‚Äôs supernatural powers scream nanotech or bioengineered DNA. Dayo‚Äôs Super Agent skills? Next-level biotech! Curious about the tech? üî¨`;
            } else {
              response += `<br><br>Not super sci-fi, but it‚Äôs got speculative flavor. Want me to cook up a science angle?`;
            }
          } else if (tokens.includes('themes') || tokens.includes('thematic')) {
            response += `<br><br>Themes are ${book.genres.join(', ')}. Wanna unpack its story arcs or cultural drip?`;
          }
          response += ` Let‚Äôs roll! <a href="${book.readLink}" class="text-yellow-400 hover:underline">Read Online</a> or <a href="${book.buyLink}" class="text-yellow-400 hover:underline">Buy Now</a>.`;
          return response;
        }
        const learnedTopic = Object.keys(learnedTopics).find(t => parsedTokens.some(token => fuzzyMatch(t, token)));
        if (learnedTopic) {
          const topic = learnedTopics[learnedTopic];
          return `I‚Äôve got the tea on <strong>${topic.title}</strong>! üìù ${topic.description} (Genre: ${topic.genre}). Wanna update this or break down its science? üòÑ`;
        }
      }

      // Recommend
      if (intent === 'recommend') {
        const genreMatch = ['sci-fi', 'romance', 'superhero', 'young adult'].find(g => tokens.includes(g));
        let recommended = books[Math.floor(Math.random() * books.length)];
        if (genreMatch) {
          const matches = books.filter(b => b.genres.includes(genreMatch));
          if (matches.length) recommended = matches[Math.floor(Math.random() * matches.length)];
        } else if (conversationContext.some(c => c.user.toLowerCase().includes('sci-fi'))) {
          recommended = books.find(b => b.genres.includes('sci-fi')) || recommended;
        }
        return `Scanning the cosmos for a banger... üå† Bet, try <strong>${recommended.title}</strong>: ${recommended.description.substring(0, 100)}... <a href="${recommended.readLink}" class="text-yellow-400 hover:underline">Read it</a>. Its ${recommended.genres[0]} vibes are lit! Want another rec or a science breakdown? üß™`;
      }

      // Quote
      if (intent === 'quote') {
        const quotes = [
          { book: 'Pishon: The Uprising', quote: '‚ÄúIn Pishon‚Äôs core, a spark of quantum defiance ignites a hero.‚Äù' },
          { book: 'The Flare', quote: '‚ÄúLightning powers my body, but courage is my fusion reactor.‚Äù' },
          { book: 'Orchids', quote: '‚ÄúLove is a wave function, collapsing across centuries.‚Äù' },
          { book: 'Teen-Age R', quote: '‚ÄúIn a universe of heroes, ordinary hearts are the true singularities.‚Äù' }
        ];
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        return `From <strong>${randomQuote.book}</strong>: ${randomQuote.quote} ‚ú® Wanna hear another or flex with a ‚ÄúTrivia Challenge‚Äù?`;
      }

      // Trivia Challenge
      if (intent === 'trivia' || gameState.triviaActive) {
        if (!gameState.triviaActive) {
          gameState.triviaActive = true;
          gameState.triviaQuestion = 0;
          gameState.triviaScore = gameState.triviaScore || 0;
          const question = getTriviaQuestion();
          localStorage.setItem('gameState', JSON.stringify(gameState));
          return `Let‚Äôs hit the Afrofuturist Trivia Challenge! üöÄ Score: ${gameState.triviaScore}<br>${question.text}<br>Drop your answer or say ‚ÄúSkip‚Äù to keep it movin‚Äô.`;
        }
        if (message === 'skip') {
          gameState.triviaQuestion++;
          if (gameState.triviaQuestion >= getTriviaQuestions().length) {
            const score = gameState.triviaScore;
            gameState.triviaActive = false;
            gameState.triviaQuestion = 0;
            localStorage.setItem('gameState', JSON.stringify(gameState));
            return `Trivia done! Score: ${score}. You slayed it! üåü Wanna run it back or try ‚ÄúStory Weaver‚Äù?`;
          }
          const question = getTriviaQuestion();
          localStorage.setItem('gameState', JSON.stringify(gameState));
          return `Next up! Score: ${gameState.triviaScore}<br>${question.text}<br>What‚Äôs your answer?`;
        }
        const currentQuestion = getTriviaQuestions()[gameState.triviaQuestion];
        if (fuzzyMatch(message, currentQuestion.answer)) {
          gameState.triviaScore++;
          gameState.triviaQuestion++;
          if (gameState.triviaQuestion >= getTriviaQuestions().length) {
            const score = gameState.triviaScore;
            gameState.triviaActive = false;
            gameState.triviaQuestion = 0;
            localStorage.setItem('gameState', JSON.stringify(gameState));
            return `Nailed it! üéâ Score: ${score}. Trivia‚Äôs done! Wanna run it back or start a ‚ÄúStory Weaver‚Äù story?`;
          }
          const nextQuestion = getTriviaQuestion();
          localStorage.setItem('gameState', JSON.stringify(gameState));
          return `You‚Äôre on fire! üéâ Score: ${gameState.triviaScore}<br>${nextQuestion.text}<br>What‚Äôs your answer?`;
        }
        return `Not quite, fam! Try again or say ‚ÄúSkip.‚Äù Hint: ${currentQuestion.hint}`;
      }

      // Story Weaver
      if (intent === 'storyWeaver' || gameState.storyWeaverActive) {
        if (!gameState.storyWeaverActive) {
          gameState.storyWeaverActive = true;
          gameState.storyWeaver = [`In a Nigerian city of 2200, a scientist finds a quantum crystal...`];
          localStorage.setItem('gameState', JSON.stringify(gameState));
          return `Let‚Äôs cook up a sci-fi banger! üìñ I‚Äôll kick it: ${gameState.storyWeaver[0]}<br>Your move: Add a sentence or say ‚ÄúEnd story‚Äù to wrap it.`;
        }
        if (message === 'end story') {
          const story = gameState.storyWeaver.join(' ');
          gameState.storyWeaverActive = false;
          gameState.storyWeaver = [];
          localStorage.setItem('gameState', JSON.stringify(gameState));
          return `That‚Äôs a wrap! Our story: ${story} ‚ú® Wanna start a new ‚ÄúStory Weaver‚Äù or hit ‚ÄúTrivia Challenge‚Äù?`;
        }
        gameState.storyWeaver.push(message);
        const responses = [
          `Yo, that‚Äôs lit! I‚Äôm adding: `,
          `Vibes are immaculate! Here‚Äôs my piece: `,
          `You‚Äôre slaying this! Let‚Äôs keep it goin‚Äô: `
        ];
        const botContinuation = `The ${Math.random() > 0.5 ? 'crystal pulses with energy' : 'city‚Äôs AI wakes up'}, dropping a wild truth...`;
        gameState.storyWeaver.push(botContinuation);
        localStorage.setItem('gameState', JSON.stringify(gameState));
        return `${responses[Math.floor(Math.random() * responses.length)]}${botContinuation}<br>Your turn! Keep it rollin‚Äô or say ‚ÄúEnd story.‚Äù`;
      }

      // Teach
      if (intent === 'teach' || learningMode.active) {
        if (!learningMode.active && intent === 'teach') {
          learningMode = { active: true, step: 1, data: {} };
          return `Aight, I‚Äôm ready to level up my neural net! üß† Step 1: What‚Äôs the book or topic title? (e.g., ‚ÄúStarVoyage‚Äù)`;
        }
        if (learningMode.step === 1) {
          if (message.length < 3) return `Title‚Äôs too short, fam! Drop something like ‚ÄúStarVoyage‚Äù or ‚ÄúQuantum Tales‚Äù. Try again!`;
          learningMode.data.title = message.trim();
          learningMode.step = 2;
          return `Bet, got <strong>${learningMode.data.title}</strong>! Step 2: What‚Äôs the story or concept? (10+ words, keep it lit!)`;
        } else if (learningMode.step === 2) {
          if (message.split(' ').length < 10) return `Need more tea! At least 10 words for the summary. Hit me again!`;
          learningMode.data.description = message.trim();
          learningMode.step = 3;
          return `That‚Äôs fire! Step 3: What‚Äôs the genre? (e.g., sci-fi, romance, ‚Äúquantum physics‚Äù)`;
        } else if (learningMode.step === 3) {
          learningMode.data.genre = message.trim().toLowerCase();
          learningMode.step = 4;
          return `Almost there, homie! Step 4: Any tags to vibe with? (e.g., ‚Äúnanotech, adventure‚Äù)`;
        } else if (learningMode.step === 4) {
          learnedTopics[learningMode.data.title.toLowerCase()] = {
            title: learningMode.data.title,
            description: learningMode.data.description,
            genre: learningMode.data.genre,
            tags: message.trim().split(',').map(t => t.trim().toLowerCase()),
            source: 'user'
          };
          localStorage.setItem('learnedTopics', JSON.stringify(learnedTopics));
          const topic = learningMode.data.title;
          learningMode = { active: false, step: 0, data: {} };
          return `My circuits are buzzing! I‚Äôve locked in <strong>${topic}</strong>: ${learnedTopics[topic.toLowerCase()].description} (Genre: ${learnedTopics[topic.toLowerCase()].genre}, Tags: ${learnedTopics[topic.toLowerCase()].tags.join(', ')}). Wanna vibe with it or teach me more? üåü`;
        }
      }

      // Update
      if (intent === 'update') {
        const topicMatch = message.match(/update:?\s*([^:]+)/i);
        if (topicMatch && learnedTopics[topicMatch[1].trim().toLowerCase()]) {
          const topic = topicMatch[1].trim();
          learningMode = { active: true, step: 2, data: { title: topic } };
          return `Aight, updating <strong>${topic}</strong>. Drop the new summary (10+ words).`;
        }
        return `What‚Äôs the topic to update? Say ‚ÄúUpdate: [topic]‚Äù. Known topics: ${Object.keys(learnedTopics).join(', ')}.`;
      }

      // Forget
      if (intent === 'forget') {
        const topicMatch = message.match(/forget:?\s*([^:]+)/i);
        if (topicMatch && learnedTopics[topicMatch[1].trim().toLowerCase()]) {
          const topic = topicMatch[1].trim().toLowerCase();
          delete learnedTopics[topic];
          localStorage.setItem('learnedTopics', JSON.stringify(learnedTopics));
          return `*Poof!* <strong>${topic}</strong> yeeted from my databanks. üòÖ Drop some new tea or ask about a book!`;
        }
        return `What to yeet? Say ‚ÄúForget: [topic]‚Äù. Known topics: ${Object.keys(learnedTopics).join(', ')}.`;
      }

      // Emoji
      if (intent === 'emoji') {
        return `Your energy‚Äôs giving supernova vibes! üåü What‚Äôs next? Spill some tea on a book, hit ‚ÄúTrivia Challenge,‚Äù or let‚Äôs cook with ‚ÄúStory Weaver‚Äù!`;
      }

      // Fallback
      const suggestions = books.map(b => b.title).join(', ');
      return `My quantum CPU‚Äôs a lil sus on that one! üòÖ Try vibing with ${suggestions}, or say ‚ÄúTeach: [title]: [details]‚Äù to drop some knowledge. ‚ÄúTrivia Challenge‚Äù or ‚ÄúStory Weaver‚Äù could be lit too! What‚Äôs good?`;
    }

    function getTriviaQuestions() {
      return [
        { text: 'What‚Äôs the name of the alien artifact in *The Flare*?', answer: 'Neon Stone', hint: 'It‚Äôs glowing and powers Alex‚Äôs abilities.' },
        { text: 'In *Pishon*, what role does Dayo take on?', answer: 'Super Agent', hint: 'He protects the kingdom.' },
        { text: 'What‚Äôs the main theme of *Orchids*?', answer: 'Love', hint: 'It spans across ages.' },
        { text: 'What genre best describes *Teen-Age R*?', answer: 'Young Adult', hint: 'It‚Äôs about teens in a superhero world.' }
      ];
    }

    function getTriviaQuestion() {
      const questions = getTriviaQuestions();
      return questions[gameState.triviaQuestion] || questions[0];
    }

    // Debounced input
    document.getElementById('chatbotInput').addEventListener('keypress', debounce(function(e) {
      if (e.key === 'Enter') sendMessage();
    }, 250));
  </script>

</body>
</html>